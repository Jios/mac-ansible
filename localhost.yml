- hosts: localhost
  connection: local
  gather_facts: no
  sudo: no
  vars:
    homebrew_taps:
      - caskroom/cask
      - homebrew/php
      - homebrew/apache
      - sanemat/font

    homebrew_packages:
      - { name: ansible }
      - { name: boris }
      - { name: brew-cask }
      - { name: colordiff }
      - { name: composer }
      - { name: coreutils }
      - { name: git }
      - { name: graphviz }
      - { name: htop-osx }
      - { name: httpd22 }
      - { name: hub }
      - { name: jq }
      - { name: mysql }
      - { name: nkf }
      - { name: node }
      - { name: openssl }
      - { name: php56 }
      - { name: php56-intl }
      - { name: php56-opcache }
      - { name: php56-apcu }
      - { name: php56-mcrypt }
      - { name: php56-xdebug }
      - { name: php56-xhprof }
      - { name: phpunit }
      - { name: python }
      - { name: reattach-to-user-namespace }
      - { name: rename }
      - { name: ricty }
      - { name: sl }
      - { name: sqlite }
      - { name: tig }
      - { name: tmux }
      - { name: tree }
      - { name: unrar }
      - { name: wget }
      - { name: zsh }
      - { name: zsh-completions }

    homebrew_cask_packages:
      - avast
      - caffeine
      - clipmenu
      - cooviewer
      - dropbox
      - eclipse-java
      - evernote
      - filezilla
      - firefox
      - flash-player
      - google-chrome
      - google-drive
      - google-japanese-ime
      - gyazo
      - heroku-toolbelt
      - java
      - karabiner
      - kobito
      - libreoffice
      - macdown
      - phpstorm
      - reaper
      - slack
      - skitch
      - skype
      - spectacle
      - sublime-text
      - vagrant
      - virtualbox
      - vlc
      - xmind
      - xtrafinder
      - xquartz

  tasks:
    - name: install taps of homebrew
      homebrew_tap: tap="{{ item }}" state=present
      with_items: homebrew_taps
      tags: [ 'brew', 'brewcask' ]

    - name: update homebrew
      homebrew: update_homebrew=yes
      tags: [ 'brew' ]

    - name: install homebrew packages
      homebrew: name="{{ item.name }}" state="{{ item.state|default('latest') }}" install_options="{{ item.install_options|default() }}"
      with_items: homebrew_packages
      tags: [ 'brew' ]

    - name: update brew-cask
      homebrew: name=brew-cask state=latest
      tags: [ 'brewcask' ]

    - name: install homebrew cask packages
      homebrew_cask: name="{{ item }}" state=present
      with_items: homebrew_cask_packages
      tags: [ 'brewcask' ]

    - name: configure apache
      patch: src=patches/httpd.conf.patch dest=/usr/local/etc/apache2/2.2/httpd.conf basedir=.
      tags: [ 'init' ]

    - name: put a sample conf file for vhosts
      template: src=templates/httpd-vhosts.conf.sample dest=/usr/local/etc/apache2/2.2/extra/httpd-vhosts.conf.sample
      tags: [ 'init' ]

    - name: configure php
      patch: src="{{ item.src }}" dest="{{ item.dest }}" basedir=.
      with_items:
        - { src: patches/php.ini.patch, dest: /usr/local/etc/php/5.6/php.ini }
        - { src: patches/ext-xdebug.ini.patch, dest: /usr/local/etc/php/5.6/conf.d/ext-xdebug.ini }
      tags: [ 'init' ]

    - name: symlink xhprof into DocumentRoot
      file: src="{{ item.src }}" dest="{{ item.dest }}" state=link
      with_items:
        - { src: /usr/local/opt/php56-xhprof/xhprof_html, dest: /usr/local/var/www/htdocs/xhprof/xhprof_html }
        - { src: /usr/local/opt/php56-xhprof/xhprof_lib, dest: /usr/local/var/www/htdocs/xhprof/xhprof_lib }
      tags: [ 'init' ]

    - name: put a snippet file into xhprof dir
      copy: src=templates/xhprof.snippet dest=/usr/local/var/www/htdocs/xhprof/xhprof.snippet
      tags: [ 'init' ]
